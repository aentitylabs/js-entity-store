var EntityStore;(()=>{"use strict";var e={665:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteSourceAction=void 0;const s=i(58);class r extends s.SourceAction{constructor(e){super("DeleteSourceAction",e)}sync(e){const t=this.entity.serialize();this.validateDelete(t),e.delete(t)}}t.DeleteSourceAction=r},753:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Entity=void 0;const s=i(608),r=i(92),n=i(190);t.Entity=class{constructor(e,t,i,s){let r;this._properties={},this._isReferenced=!1,this._source=new n.NullSource,this._isItem=!1,this._isCollection=!1,this._item={},this._entityStore=e,this._name=t,this._key=t,this._item=s,this._isCollection=!!s,null!=i&&null!=i&&(this._key=i.key+"=>"+this._key,this._isReferenced=!0,r=i._source),this._ref=i,this._entityStore.register(this,r),i||(this._ref=this,this._entityStore.load(this))}set key(e){this._key=e}get key(){return this._key}get name(){return this._name}get ref(){return this._ref}get properties(){return this._properties}get source(){return this._source}get entityStore(){return this._entityStore}set source(e){this._source=e}get isReferenced(){return this._isReferenced}set isItem(e){this._isItem=e}get isItem(){return this._isItem}delete(){this._entityStore.delete(this)}get(e){return this.properties[e].value}add(){const e=s.EntityFactory.newEntity(this._entityStore,this._item,this);e.deserialize(this._item);const t=Object.keys(this._properties).length;return this._properties[t]=e,e._key=e._key+"["+t+"]",e._isItem=!0,this.entityStore.register(e,this._source),this._entityStore.update(e),this._entityStore.load(this),e}remove(e){const t=this.get(e);this._entityStore.delete(t),this._entityStore.load(this)}serialize(){const e={};for(var t in e.entity=this._name,e.properties={},e.ref=this._isReferenced,this._properties)e.properties[t]=this._properties[t].serialize();return e}deserialize(e){if(this._name=e.entity,!e.properties)return;let t=0;for(let i in e.properties){const s=new r.EntityProperty(this._entityStore,this);if(s.deserialize(e.properties[i]),this._properties[i]=s,this._isCollection){const e=s.value;e.key=e.key+"["+t+"]",e.isItem=!0,this._entityStore.register(e,this.source)}t++}}}},608:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityFactory=void 0;const s=i(753),r=i(557);t.EntityFactory=class{static newEntity(e,t,i){let n=null;return n=t.collectionItem?new s.Entity(e,t.entity,i,t.collectionItem):new s.Entity(e,t.entity,i),n.deserialize(t),new Proxy(n,new r.EntityHandler)}}},557:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityHandler=void 0,t.EntityHandler=class{get(e,t,i){return e.properties[t]?e.properties[t].value:e[t]}set(e,t,i){return e.properties[t]?(e.properties[t].value=i,e.entityStore.update(e),!0):(e[t]=i,!0)}}},92:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityProperty=void 0;const s=i(608);t.EntityProperty=class{constructor(e,t){this._isEntity=!1,this._entityStore=e,this._ref=t}get isEntity(){return this._isEntity}get value(){return this._value}set value(e){this._value=e}serialize(){return!0===this._isEntity?this._value.serialize():{value:this._value}}deserialize(e){if(e.entity){const t=!0===e.ref?this._ref:void 0;return this._value=s.EntityFactory.newEntity(this._entityStore,e,t),this._isEntity=!0,void this._value.deserialize(e)}this._value=e.value}}},328:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LoadSourceAction=void 0;const s=i(58);class r extends s.SourceAction{constructor(e){super("LoadSourceAction",e)}sync(e){const t=this.entity.serialize(),i=e.load(t);this.validateLoad(i),this.entity.deserialize(i)}}t.LoadSourceAction=r},190:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NullSource=void 0;const s=i(886);class r extends s.Source{load(e){return e}update(e){return e}delete(e){}}t.NullSource=r},625:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NullSourceAction=void 0;const s=i(58);class r extends s.SourceAction{constructor(e){super("NullSourceAction",e)}sync(e){throw new Error("NullSourceAction: method not implemented.")}}t.NullSourceAction=r},886:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Source=void 0,t.Source=class{}},58:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SourceAction=void 0,t.SourceAction=class{constructor(e,t){this._type=e,this._entity=t}get type(){return this._type}get entity(){return this._entity}set entity(e){this._entity=e}validateLoad(e){}validateUpdate(e){}validateDelete(e){}}},172:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SourceActionFactory=void 0;const s=i(665),r=i(328),n=i(625),o=i(246);t.SourceActionFactory=class{static serialize(e){const t={};return t.type=e.type,t.entityKey=e.entity.key,t.entityType=e.entity.name,t.entity=e.entity.serialize(),t.refKey=e.entity.ref?e.entity.ref.key:void 0,t}static deserialize(e,t){switch(e.type){case"LoadSourceAction":return new r.LoadSourceAction(t);case"UpdateSourceAction":return new o.UpdateSourceAction(t);case"DeleteSourceAction":return new s.DeleteSourceAction(t)}return new n.NullSourceAction(t)}}},246:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateSourceAction=void 0;const s=i(58);class r extends s.SourceAction{constructor(e){super("UpdateSourceAction",e)}sync(e){const t=this.entity.serialize();this.validateUpdate(t);const i=e.update(t);this.entity.deserialize(i)}}t.UpdateSourceAction=r}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}var s={};(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.EntityStore=void 0;const t=i(665),r=i(608),n=i(328),o=i(190),c=i(172),u=i(246);e.EntityStore=class{constructor(){this._sources={},this._entities={},this._actions={}}get actions(){return this._actions}addSource(e,t){this._sources[e]=t}register(e,t){if(this._entities[e.key]=e,t)e.source=t;else{let t=this._sources[e.name];e.source=t?this._sources[e.name]:new o.NullSource}}sync(){for(;Object.keys(this._actions).length>0;){const e=Object.keys(this._actions)[0],t=this._actions[e];t.sync(t.entity.source),delete this._actions[e]}}syncTo(e){const t={};for(const e in this._actions){const i=this._actions[e];i.sync(i.entity.source),t[e]=c.SourceActionFactory.serialize(i)}const i=e.send(t);for(;Object.keys(this._actions).length>0;){const e=Object.keys(this._actions)[0],t=this._actions[e],s=t.entity.name;i[s]&&(t.entity.deserialize(i[s]),t.sync(this._sources[s])),delete this._actions[e]}}syncFrom(e,t){const i={},s={};for(const e in t){const n=t[e];this._entities[n.entityKey]||(this._entities[n.entityKey]=r.EntityFactory.newEntity(this,n.entity,this._entities[n.refKey]));const o=this._entities[n.entityKey];o.deserialize(n.entity),i[e]=c.SourceActionFactory.deserialize(n,o);const u=i[e].entity.name;this._sources[u]&&(i[e].sync(this._sources[u]),s[u]=i[e].entity.serialize())}this.sync(),e.reply(s)}load(e){if(e.isReferenced&&!e.isItem&&e.ref)return this.load(e.ref);this._actions[e.key+"::load"]=new n.LoadSourceAction(e)}update(e){if(e.isReferenced&&!e.isItem&&e.ref)return this.update(e.ref);this._actions[e.key+"::update"]=new u.UpdateSourceAction(e)}delete(e){if(e.isReferenced&&!e.isItem&&e.ref)return this.delete(e.ref);this._actions[e.key+"::delete"]=new t.DeleteSourceAction(e)}}})(),EntityStore=s})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFjLElBQUksRUFBQThDLG1CQUFtQnRFLEdBRzdEUSxPQUFPUixHQUNWLEdBQUdBLEVBQU9nRyxlQUFpQmhHLEVBQU8rQyxRQUFVL0MsRUFBT1csSUFDL0MsT0FBT04sS0FBS0csT0FBT1IsRUFBT1csS0FHOUJOLEtBQUsyRSxTQUFTaEYsRUFBT3dCLElBQU0sWUFBYyxJQUFJLEVBQUEzQixtQkFBbUJHLE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9FbnRpdHlTdG9yZS9DOlxcd29ya1xcYWVudGl0eVxcd29ya3NwYWNlXFxqcy1lbnRpdHktc3RvcmVcXHNyY1xcZGVsZXRlc291cmNlYWN0aW9uLnRzIiwid2VicGFjazovL0VudGl0eVN0b3JlL0M6XFx3b3JrXFxhZW50aXR5XFx3b3Jrc3BhY2VcXGpzLWVudGl0eS1zdG9yZVxcc3JjXFxlbnRpdHkudHMiLCJ3ZWJwYWNrOi8vRW50aXR5U3RvcmUvQzpcXHdvcmtcXGFlbnRpdHlcXHdvcmtzcGFjZVxcanMtZW50aXR5LXN0b3JlXFxzcmNcXGVudGl0eWZhY3RvcnkudHMiLCJ3ZWJwYWNrOi8vRW50aXR5U3RvcmUvQzpcXHdvcmtcXGFlbnRpdHlcXHdvcmtzcGFjZVxcanMtZW50aXR5LXN0b3JlXFxzcmNcXGVudGl0eWhhbmRsZXIudHMiLCJ3ZWJwYWNrOi8vRW50aXR5U3RvcmUvQzpcXHdvcmtcXGFlbnRpdHlcXHdvcmtzcGFjZVxcanMtZW50aXR5LXN0b3JlXFxzcmNcXGVudGl0eXByb3BlcnR5LnRzIiwid2VicGFjazovL0VudGl0eVN0b3JlL0M6XFx3b3JrXFxhZW50aXR5XFx3b3Jrc3BhY2VcXGpzLWVudGl0eS1zdG9yZVxcc3JjXFxsb2Fkc291cmNlYWN0aW9uLnRzIiwid2VicGFjazovL0VudGl0eVN0b3JlL0M6XFx3b3JrXFxhZW50aXR5XFx3b3Jrc3BhY2VcXGpzLWVudGl0eS1zdG9yZVxcc3JjXFxudWxsc291cmNlLnRzIiwid2VicGFjazovL0VudGl0eVN0b3JlL0M6XFx3b3JrXFxhZW50aXR5XFx3b3Jrc3BhY2VcXGpzLWVudGl0eS1zdG9yZVxcc3JjXFxudWxsc291cmNlYWN0aW9uLnRzIiwid2VicGFjazovL0VudGl0eVN0b3JlL0M6XFx3b3JrXFxhZW50aXR5XFx3b3Jrc3BhY2VcXGpzLWVudGl0eS1zdG9yZVxcc3JjXFxzb3VyY2UudHMiLCJ3ZWJwYWNrOi8vRW50aXR5U3RvcmUvQzpcXHdvcmtcXGFlbnRpdHlcXHdvcmtzcGFjZVxcanMtZW50aXR5LXN0b3JlXFxzcmNcXHNvdXJjZWFjdGlvbi50cyIsIndlYnBhY2s6Ly9FbnRpdHlTdG9yZS9DOlxcd29ya1xcYWVudGl0eVxcd29ya3NwYWNlXFxqcy1lbnRpdHktc3RvcmVcXHNyY1xcc291cmNlYWN0aW9uZmFjdG9yeS50cyIsIndlYnBhY2s6Ly9FbnRpdHlTdG9yZS9DOlxcd29ya1xcYWVudGl0eVxcd29ya3NwYWNlXFxqcy1lbnRpdHktc3RvcmVcXHNyY1xcdXBkYXRlc291cmNlYWN0aW9uLnRzIiwid2VicGFjazovL0VudGl0eVN0b3JlL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0VudGl0eVN0b3JlL0M6XFx3b3JrXFxhZW50aXR5XFx3b3Jrc3BhY2VcXGpzLWVudGl0eS1zdG9yZVxcc3JjXFxlbnRpdHlzdG9yZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbnRpdHkgfSBmcm9tIFwiLi9lbnRpdHlcIjtcclxuaW1wb3J0IHsgU291cmNlIH0gZnJvbSBcIi4vc291cmNlXCI7XHJcbmltcG9ydCB7IFNvdXJjZUFjdGlvbiB9IGZyb20gXCIuL3NvdXJjZWFjdGlvblwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIERlbGV0ZVNvdXJjZUFjdGlvbiBleHRlbmRzIFNvdXJjZUFjdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcihlbnRpdHk6IEVudGl0eSkge1xyXG4gICAgICAgIHN1cGVyKFwiRGVsZXRlU291cmNlQWN0aW9uXCIsIGVudGl0eSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN5bmMoc291cmNlOiBTb3VyY2UpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBzZXJpYWxpemVkRW50aXR5ID0gdGhpcy5lbnRpdHkuc2VyaWFsaXplKCk7XHJcblxyXG4gICAgICAgIHRoaXMudmFsaWRhdGVEZWxldGUoc2VyaWFsaXplZEVudGl0eSk7XHJcblxyXG4gICAgICAgIHNvdXJjZS5kZWxldGUoc2VyaWFsaXplZEVudGl0eSk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBFbnRpdHlGYWN0b3J5IH0gZnJvbSBcIi4vZW50aXR5ZmFjdG9yeVwiO1xyXG5pbXBvcnQgeyBFbnRpdHlQcm9wZXJ0eSB9IGZyb20gXCIuL2VudGl0eXByb3BlcnR5XCI7XHJcbmltcG9ydCB7IEVudGl0eVN0b3JlIH0gZnJvbSBcIi4vZW50aXR5c3RvcmVcIjtcclxuaW1wb3J0IHsgTnVsbFNvdXJjZSB9IGZyb20gXCIuL251bGxzb3VyY2VcIjtcclxuaW1wb3J0IHsgU291cmNlIH0gZnJvbSBcIi4vc291cmNlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgRW50aXR5IHtcclxuICAgIHByaXZhdGUgX2VudGl0eVN0b3JlOiBFbnRpdHlTdG9yZTtcclxuICAgIHByb3RlY3RlZCBfcHJvcGVydGllczogYW55ID0ge307XHJcbiAgICBwcml2YXRlIF9uYW1lOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9rZXk6IHN0cmluZztcclxuICAgIHByaXZhdGUgX3JlZjogRW50aXR5fHVuZGVmaW5lZDtcclxuICAgIHByaXZhdGUgX2lzUmVmZXJlbmNlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBfc291cmNlOiBTb3VyY2UgPSBuZXcgTnVsbFNvdXJjZSgpO1xyXG4gICAgcHJpdmF0ZSBfaXNJdGVtOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIF9pc0NvbGxlY3Rpb246IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByb3RlY3RlZCBfaXRlbTogYW55ID0ge307XHJcblxyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihlbnRpdHlTdG9yZTogRW50aXR5U3RvcmUsIG5hbWU6IHN0cmluZywgcmVmPzogRW50aXR5LCBpdGVtPzogYW55KVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX2VudGl0eVN0b3JlID0gZW50aXR5U3RvcmU7XHJcblxyXG4gICAgICAgIHRoaXMuX25hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuX2tleSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5faXRlbSA9IGl0ZW07XHJcbiAgICAgICAgdGhpcy5faXNDb2xsZWN0aW9uID0gaXRlbSA/IHRydWUgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgbGV0IHNvdXJjZTtcclxuXHJcbiAgICAgICAgaWYocmVmICE9IG51bGwgJiYgcmVmICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLl9rZXkgPSByZWYua2V5ICsgXCI9PlwiICsgdGhpcy5fa2V5O1xyXG4gICAgICAgICAgICB0aGlzLl9pc1JlZmVyZW5jZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBzb3VyY2UgPSByZWYuX3NvdXJjZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX3JlZiA9IHJlZjtcclxuXHJcbiAgICAgICAgdGhpcy5fZW50aXR5U3RvcmUucmVnaXN0ZXIodGhpcywgc291cmNlKTtcclxuXHJcbiAgICAgICAgaWYoIXJlZikge1xyXG4gICAgICAgICAgICB0aGlzLl9yZWYgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLl9lbnRpdHlTdG9yZS5sb2FkKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0IGtleSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fa2V5ID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBrZXkoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fa2V5O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgbmFtZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9uYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgcmVmKCk6IEVudGl0eXx1bmRlZmluZWQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9yZWY7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBwcm9wZXJ0aWVzKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnRpZXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBzb3VyY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IGVudGl0eVN0b3JlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9lbnRpdHlTdG9yZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0IHNvdXJjZShzb3VyY2U6IFNvdXJjZSkge1xyXG4gICAgICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IGlzUmVmZXJlbmNlZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXNSZWZlcmVuY2VkO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgaXNJdGVtKHZhbHVlOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5faXNJdGVtID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBpc0l0ZW0oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzSXRlbTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGVsZXRlKCkge1xyXG4gICAgICAgIHRoaXMuX2VudGl0eVN0b3JlLmRlbGV0ZSh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0KGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzW2luZGV4XS52YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkKCk6IEVudGl0eSB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5ID0gRW50aXR5RmFjdG9yeS5uZXdFbnRpdHkodGhpcy5fZW50aXR5U3RvcmUsIHRoaXMuX2l0ZW0sIHRoaXMpO1xyXG5cclxuICAgICAgICBlbnRpdHkuZGVzZXJpYWxpemUodGhpcy5faXRlbSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbGxlY3Rpb25TaXplID0gT2JqZWN0LmtleXModGhpcy5fcHJvcGVydGllcykubGVuZ3RoO1xyXG5cclxuICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzW2NvbGxlY3Rpb25TaXplXSA9IGVudGl0eTtcclxuXHJcbiAgICAgICAgZW50aXR5Ll9rZXkgPSBlbnRpdHkuX2tleSArIFwiW1wiICsgKGNvbGxlY3Rpb25TaXplKSArIFwiXVwiO1xyXG5cclxuICAgICAgICBlbnRpdHkuX2lzSXRlbSA9IHRydWU7XHJcblxyXG4gICAgICAgIHRoaXMuZW50aXR5U3RvcmUucmVnaXN0ZXIoZW50aXR5LCB0aGlzLl9zb3VyY2UpO1xyXG5cclxuICAgICAgICB0aGlzLl9lbnRpdHlTdG9yZS51cGRhdGUoZW50aXR5KTtcclxuXHJcbiAgICAgICAgdGhpcy5fZW50aXR5U3RvcmUubG9hZCh0aGlzKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGVudGl0eTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVtb3ZlKGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCB0b1JlbW92ZSA9IHRoaXMuZ2V0KGluZGV4KTtcclxuXHJcbiAgICAgICAgdGhpcy5fZW50aXR5U3RvcmUuZGVsZXRlKHRvUmVtb3ZlKTtcclxuXHJcbiAgICAgICAgdGhpcy5fZW50aXR5U3RvcmUubG9hZCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2VyaWFsaXplKCk6IGFueSB7XHJcbiAgICAgICAgY29uc3Qgc2VyaWFsaXplZEVudGl0eTogYW55ID0ge307XHJcblxyXG4gICAgICAgIHNlcmlhbGl6ZWRFbnRpdHlbXCJlbnRpdHlcIl0gPSB0aGlzLl9uYW1lO1xyXG4gICAgICAgIHNlcmlhbGl6ZWRFbnRpdHlbXCJwcm9wZXJ0aWVzXCJdID0ge307XHJcbiAgICAgICAgc2VyaWFsaXplZEVudGl0eVtcInJlZlwiXSA9IHRoaXMuX2lzUmVmZXJlbmNlZDtcclxuXHJcbiAgICAgICAgZm9yKHZhciBrZXkgaW4gdGhpcy5fcHJvcGVydGllcykge1xyXG4gICAgICAgICAgICBzZXJpYWxpemVkRW50aXR5W1wicHJvcGVydGllc1wiXVtrZXldID0gdGhpcy5fcHJvcGVydGllc1trZXldLnNlcmlhbGl6ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcmlhbGl6ZWRFbnRpdHk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBkZXNlcmlhbGl6ZShlbnRpdHk6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX25hbWUgPSBlbnRpdHlbXCJlbnRpdHlcIl07XHJcblxyXG4gICAgICAgIGlmKCFlbnRpdHlbXCJwcm9wZXJ0aWVzXCJdKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBpID0gMDtcclxuXHJcbiAgICAgICAgZm9yKGxldCBrZXkgaW4gZW50aXR5W1wicHJvcGVydGllc1wiXSkge1xyXG4gICAgICAgICAgICBjb25zdCBlbnRpdHlQcm9wZXJ0eSA9IG5ldyBFbnRpdHlQcm9wZXJ0eSh0aGlzLl9lbnRpdHlTdG9yZSwgdGhpcyk7XHJcblxyXG4gICAgICAgICAgICBlbnRpdHlQcm9wZXJ0eS5kZXNlcmlhbGl6ZShlbnRpdHlbXCJwcm9wZXJ0aWVzXCJdW2tleV0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fcHJvcGVydGllc1trZXldID0gZW50aXR5UHJvcGVydHk7XHJcblxyXG4gICAgICAgICAgICBpZih0aGlzLl9pc0NvbGxlY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVudGl0eUl0ZW0gPSBlbnRpdHlQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBlbnRpdHlJdGVtLmtleSA9IGVudGl0eUl0ZW0ua2V5ICsgXCJbXCIgKyBpICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgZW50aXR5SXRlbS5pc0l0ZW0gPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2VudGl0eVN0b3JlLnJlZ2lzdGVyKGVudGl0eUl0ZW0sIHRoaXMuc291cmNlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBFbnRpdHkgfSBmcm9tIFwiLi9lbnRpdHlcIjtcclxuaW1wb3J0IHsgRW50aXR5SGFuZGxlciB9IGZyb20gXCIuL2VudGl0eWhhbmRsZXJcIjtcclxuaW1wb3J0IHsgRW50aXR5U3RvcmUgfSBmcm9tIFwiLi9lbnRpdHlzdG9yZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEVudGl0eUZhY3Rvcnkge1xyXG4gICAgcHVibGljIHN0YXRpYyBuZXdFbnRpdHkoZW50aXR5U3RvcmU6IEVudGl0eVN0b3JlLCBlbnRpdHk6IGFueSwgcmVmPzogRW50aXR5KSB7XHJcbiAgICAgICAgbGV0IG5ld0VudGl0eTogRW50aXR5fG51bGwgPSBudWxsO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKGVudGl0eVtcImNvbGxlY3Rpb25JdGVtXCJdKSB7XHJcbiAgICAgICAgICAgIG5ld0VudGl0eSA9IG5ldyBFbnRpdHkoZW50aXR5U3RvcmUsIGVudGl0eVtcImVudGl0eVwiXSwgcmVmLCBlbnRpdHlbXCJjb2xsZWN0aW9uSXRlbVwiXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBuZXdFbnRpdHkgPSBuZXcgRW50aXR5KGVudGl0eVN0b3JlLCBlbnRpdHlbXCJlbnRpdHlcIl0sIHJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBuZXdFbnRpdHkuZGVzZXJpYWxpemUoZW50aXR5KTtcclxuXHJcbiAgICAgICAgY29uc3QgZW50aXR5UHJveHkgPSBuZXcgUHJveHkobmV3RW50aXR5LCBuZXcgRW50aXR5SGFuZGxlcigpKVxyXG5cclxuICAgICAgICByZXR1cm4gZW50aXR5UHJveHk7XHJcbiAgICB9XHJcbn1cclxuIiwiZXhwb3J0IGNsYXNzIEVudGl0eUhhbmRsZXIge1xyXG4gICAgZ2V0KHRhcmdldDogYW55LCBwcm9wZXJ0eTogYW55LCByZWNlaXZlcjogYW55KTogYW55IHtcclxuICAgICAgICBpZih0YXJnZXQucHJvcGVydGllc1twcm9wZXJ0eV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5wcm9wZXJ0aWVzW3Byb3BlcnR5XS52YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0YXJnZXRbcHJvcGVydHldO1xyXG4gICAgfVxyXG5cclxuICAgIHNldChvYmo6IGFueSwgcHJvcGVydHk6IGFueSwgdmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmKG9iai5wcm9wZXJ0aWVzW3Byb3BlcnR5XSkge1xyXG4gICAgICAgICAgICBvYmoucHJvcGVydGllc1twcm9wZXJ0eV0udmFsdWUgPSB2YWx1ZTtcclxuXHJcbiAgICAgICAgICAgIG9iai5lbnRpdHlTdG9yZS51cGRhdGUob2JqKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqW3Byb3BlcnR5XSA9IHZhbHVlO1xyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IEVudGl0eSB9IGZyb20gXCIuL2VudGl0eVwiO1xyXG5pbXBvcnQgeyBFbnRpdHlGYWN0b3J5IH0gZnJvbSBcIi4vZW50aXR5ZmFjdG9yeVwiO1xyXG5pbXBvcnQgeyBFbnRpdHlTdG9yZSB9IGZyb20gXCIuL2VudGl0eXN0b3JlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgRW50aXR5UHJvcGVydHkge1xyXG4gICAgcHJpdmF0ZSBfZW50aXR5U3RvcmU6IEVudGl0eVN0b3JlO1xyXG4gICAgcHJpdmF0ZSBfcmVmOiBFbnRpdHl8dW5kZWZpbmVkO1xyXG4gICAgcHJpdmF0ZSBfaXNFbnRpdHk6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgX3ZhbHVlOiBhbnk7XHJcblxyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihlbnRpdHlTdG9yZTogRW50aXR5U3RvcmUsIHJlZj86IEVudGl0eSlcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9lbnRpdHlTdG9yZSA9IGVudGl0eVN0b3JlO1xyXG4gICAgICAgIHRoaXMuX3JlZiA9IHJlZjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IGlzRW50aXR5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pc0VudGl0eTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IHZhbHVlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0IHZhbHVlKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2VyaWFsaXplKCk6IGFueSB7XHJcbiAgICAgICAgaWYodGhpcy5faXNFbnRpdHkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnNlcmlhbGl6ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgXCJ2YWx1ZVwiOiB0aGlzLl92YWx1ZVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBkZXNlcmlhbGl6ZShlbnRpdHlQcm9wZXJ0eTogYW55KSB7XHJcbiAgICAgICAgaWYoZW50aXR5UHJvcGVydHlbXCJlbnRpdHlcIl0pIHtcclxuICAgICAgICAgICAgY29uc3QgcmVmOiBFbnRpdHl8dW5kZWZpbmVkID0gZW50aXR5UHJvcGVydHlbXCJyZWZcIl0gPT09IHRydWUgPyB0aGlzLl9yZWYgOiB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl92YWx1ZSA9IEVudGl0eUZhY3RvcnkubmV3RW50aXR5KHRoaXMuX2VudGl0eVN0b3JlLCBlbnRpdHlQcm9wZXJ0eSwgcmVmKTtcclxuICAgICAgICAgICAgdGhpcy5faXNFbnRpdHkgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fdmFsdWUuZGVzZXJpYWxpemUoZW50aXR5UHJvcGVydHkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fdmFsdWUgPSBlbnRpdHlQcm9wZXJ0eVtcInZhbHVlXCJdO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgRW50aXR5IH0gZnJvbSBcIi4vZW50aXR5XCI7XHJcbmltcG9ydCB7IFNvdXJjZSB9IGZyb20gXCIuL3NvdXJjZVwiO1xyXG5pbXBvcnQgeyBTb3VyY2VBY3Rpb24gfSBmcm9tIFwiLi9zb3VyY2VhY3Rpb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBMb2FkU291cmNlQWN0aW9uIGV4dGVuZHMgU291cmNlQWN0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKGVudGl0eTogRW50aXR5KSB7XHJcbiAgICAgICAgc3VwZXIoXCJMb2FkU291cmNlQWN0aW9uXCIsIGVudGl0eSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN5bmMoc291cmNlOiBTb3VyY2UpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBzZXJpYWxpemVkRW50aXR5OiBhbnkgPSB0aGlzLmVudGl0eS5zZXJpYWxpemUoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgY29uc3Qgc2VyaWFsaXplZExvYWRlZEVudGl0eSA9IHNvdXJjZS5sb2FkKHNlcmlhbGl6ZWRFbnRpdHkpO1xyXG5cclxuICAgICAgICB0aGlzLnZhbGlkYXRlTG9hZChzZXJpYWxpemVkTG9hZGVkRW50aXR5KTtcclxuXHJcbiAgICAgICAgdGhpcy5lbnRpdHkuZGVzZXJpYWxpemUoc2VyaWFsaXplZExvYWRlZEVudGl0eSk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBTb3VyY2UgfSBmcm9tIFwiLi9zb3VyY2VcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBOdWxsU291cmNlIGV4dGVuZHMgU291cmNlIHtcclxuICAgIHB1YmxpYyBsb2FkKGVudGl0eTogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcHVibGljIHVwZGF0ZShlbnRpdHk6IGFueSkge1xyXG4gICAgICAgIHJldHVybiBlbnRpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRlbGV0ZShlbnRpdHk6IGFueSk6IHZvaWQge1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7IEVudGl0eSB9IGZyb20gXCIuL2VudGl0eVwiO1xyXG5pbXBvcnQgeyBTb3VyY2UgfSBmcm9tIFwiLi9zb3VyY2VcIjtcclxuaW1wb3J0IHsgU291cmNlQWN0aW9uIH0gZnJvbSBcIi4vc291cmNlYWN0aW9uXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgTnVsbFNvdXJjZUFjdGlvbiBleHRlbmRzIFNvdXJjZUFjdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcihlbnRpdHk6IEVudGl0eSkge1xyXG4gICAgICAgIHN1cGVyKFwiTnVsbFNvdXJjZUFjdGlvblwiLCBlbnRpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzeW5jKHNvdXJjZTogU291cmNlKTogdm9pZCB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTnVsbFNvdXJjZUFjdGlvbjogbWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XHJcbiAgICB9XHJcbn0iLCJleHBvcnQgYWJzdHJhY3QgY2xhc3MgU291cmNlIHtcclxuICAgIHB1YmxpYyBhYnN0cmFjdCBsb2FkKGVudGl0eTogYW55KTogYW55O1xyXG4gICAgcHVibGljIGFic3RyYWN0IHVwZGF0ZShlbnRpdHk6IGFueSk6IGFueTtcclxuICAgIHB1YmxpYyBhYnN0cmFjdCBkZWxldGUoZW50aXR5OiBhbnkpOiB2b2lkO1xyXG59XHJcbiIsImltcG9ydCB7IEVudGl0eSB9IGZyb20gXCIuL2VudGl0eVwiO1xyXG5pbXBvcnQgeyBTb3VyY2UgfSBmcm9tIFwiLi9zb3VyY2VcIjtcclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBTb3VyY2VBY3Rpb24ge1xyXG4gICAgcHJpdmF0ZSBfdHlwZTogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBfZW50aXR5OiBFbnRpdHk7XHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IHN0cmluZywgZW50aXR5OiBFbnRpdHkpIHtcclxuICAgICAgICB0aGlzLl90eXBlID0gdHlwZTtcclxuICAgICAgICB0aGlzLl9lbnRpdHkgPSBlbnRpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFic3RyYWN0IHN5bmMoc291cmNlOiBTb3VyY2UpOiB2b2lkO1xyXG5cclxuICAgIHB1YmxpYyBnZXQgdHlwZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IGVudGl0eSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZW50aXR5O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgZW50aXR5KHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5fZW50aXR5ID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIHZhbGlkYXRlTG9hZChzZXJpYWxpemVkRW50aXR5OiBhbnkpIHtcclxuICAgICAgICAvKiR2YWxpZGF0b3JzID0gJHRoaXMtPmVudGl0eS0+Z2V0RW50aXR5U3RvcmUoKS0+Z2V0TG9hZFZhbGlkYXRvcnMoKTtcclxuXHJcbiAgICAgICAgJGVudGl0eUNsYXNzID0gJHRoaXMtPmdldEVudGl0eSgpLT5uYW1lO1xyXG5cclxuICAgICAgICBpZihhcnJheV9rZXlfZXhpc3RzKCRlbnRpdHlDbGFzcywgJHZhbGlkYXRvcnMpKSB7XHJcbiAgICAgICAgICAgICR1cGRhdGVWYWxpZGF0b3IgPSAkdmFsaWRhdG9yc1skZW50aXR5Q2xhc3NdO1xyXG5cclxuICAgICAgICAgICAgaWYoISR1cGRhdGVWYWxpZGF0b3ItPmlzVmFsaWQoJHNlcmlhbGl6ZWRFbnRpdHkpKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRW50aXR5TG9hZFZhbGlkYXRpb25FeGNlcHRpb24oJHVwZGF0ZVZhbGlkYXRvci0+Z2V0UHJvcGVydHlFcnJvcnMoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9Ki9cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgdmFsaWRhdGVVcGRhdGUoc2VyaWFsaXplZEVudGl0eTogYW55KSB7XHJcbiAgICAgICAgLyokdmFsaWRhdG9ycyA9ICR0aGlzLT5lbnRpdHktPmdldEVudGl0eVN0b3JlKCktPmdldFVwZGF0ZVZhbGlkYXRvcnMoKTtcclxuXHJcbiAgICAgICAgJGVudGl0eUNsYXNzID0gJHRoaXMtPmdldEVudGl0eSgpLT5uYW1lO1xyXG5cclxuICAgICAgICBpZihhcnJheV9rZXlfZXhpc3RzKCRlbnRpdHlDbGFzcywgJHZhbGlkYXRvcnMpKSB7XHJcbiAgICAgICAgICAgICR1cGRhdGVWYWxpZGF0b3IgPSAkdmFsaWRhdG9yc1skZW50aXR5Q2xhc3NdO1xyXG5cclxuICAgICAgICAgICAgaWYoISR1cGRhdGVWYWxpZGF0b3ItPmlzVmFsaWQoJHNlcmlhbGl6ZWRFbnRpdHkpKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRW50aXR5VXBkYXRlVmFsaWRhdGlvbkV4Y2VwdGlvbigkdXBkYXRlVmFsaWRhdG9yLT5nZXRQcm9wZXJ0eUVycm9ycygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0qL1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCB2YWxpZGF0ZURlbGV0ZShzZXJpYWxpemVkRW50aXR5OiBhbnkpIHtcclxuICAgICAgICAvKiR2YWxpZGF0b3JzID0gJHRoaXMtPmVudGl0eS0+Z2V0RW50aXR5U3RvcmUoKS0+Z2V0RGVsZXRlVmFsaWRhdG9ycygpO1xyXG5cclxuICAgICAgICAkZW50aXR5Q2xhc3MgPSAkdGhpcy0+Z2V0RW50aXR5KCktPm5hbWU7XHJcblxyXG4gICAgICAgIGlmKGFycmF5X2tleV9leGlzdHMoJGVudGl0eUNsYXNzLCAkdmFsaWRhdG9ycykpIHtcclxuICAgICAgICAgICAgJHVwZGF0ZVZhbGlkYXRvciA9ICR2YWxpZGF0b3JzWyRlbnRpdHlDbGFzc107XHJcblxyXG4gICAgICAgICAgICBpZighJHVwZGF0ZVZhbGlkYXRvci0+aXNWYWxpZCgkc2VyaWFsaXplZEVudGl0eSkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFbnRpdHlEZWxldGVWYWxpZGF0aW9uRXhjZXB0aW9uKCR1cGRhdGVWYWxpZGF0b3ItPmdldFByb3BlcnR5RXJyb3JzKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSovXHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBEZWxldGVTb3VyY2VBY3Rpb24gfSBmcm9tIFwiLi9kZWxldGVzb3VyY2VhY3Rpb25cIjtcclxuaW1wb3J0IHsgRW50aXR5IH0gZnJvbSBcIi4vZW50aXR5XCI7XHJcbmltcG9ydCB7IEVudGl0eVN0b3JlIH0gZnJvbSBcIi4vZW50aXR5c3RvcmVcIjtcclxuaW1wb3J0IHsgTG9hZFNvdXJjZUFjdGlvbiB9IGZyb20gXCIuL2xvYWRzb3VyY2VhY3Rpb25cIjtcclxuaW1wb3J0IHsgTnVsbFNvdXJjZUFjdGlvbiB9IGZyb20gXCIuL251bGxzb3VyY2VhY3Rpb25cIjtcclxuaW1wb3J0IHsgU291cmNlQWN0aW9uIH0gZnJvbSBcIi4vc291cmNlYWN0aW9uXCI7XHJcbmltcG9ydCB7IFVwZGF0ZVNvdXJjZUFjdGlvbiB9IGZyb20gXCIuL3VwZGF0ZXNvdXJjZWFjdGlvblwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNvdXJjZUFjdGlvbkZhY3Rvcnkge1xyXG4gICAgcHVibGljIHN0YXRpYyBzZXJpYWxpemUoc291cmNlQWN0aW9uOiBTb3VyY2VBY3Rpb24pOiBhbnkge1xyXG4gICAgICAgIGNvbnN0IHNlcmlhbGl6ZWRTb3VyY2VBY3Rpb246IGFueSA9IHt9O1xyXG5cclxuICAgICAgICBzZXJpYWxpemVkU291cmNlQWN0aW9uW1widHlwZVwiXSA9IHNvdXJjZUFjdGlvbi50eXBlO1xyXG4gICAgICAgIHNlcmlhbGl6ZWRTb3VyY2VBY3Rpb25bXCJlbnRpdHlLZXlcIl0gPSBzb3VyY2VBY3Rpb24uZW50aXR5LmtleTtcclxuICAgICAgICBzZXJpYWxpemVkU291cmNlQWN0aW9uW1wiZW50aXR5VHlwZVwiXSA9IHNvdXJjZUFjdGlvbi5lbnRpdHkubmFtZTtcclxuICAgICAgICBzZXJpYWxpemVkU291cmNlQWN0aW9uW1wiZW50aXR5XCJdID0gc291cmNlQWN0aW9uLmVudGl0eS5zZXJpYWxpemUoKTtcclxuICAgICAgICBzZXJpYWxpemVkU291cmNlQWN0aW9uW1wicmVmS2V5XCJdID0gc291cmNlQWN0aW9uLmVudGl0eS5yZWYgPyBzb3VyY2VBY3Rpb24uZW50aXR5LnJlZi5rZXkgOiB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJpYWxpemVkU291cmNlQWN0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZGVzZXJpYWxpemUoc2VyaWFsaXplZFNvdXJjZUFjdGlvbjogYW55LCBlbnRpdHk6IEVudGl0eSk6IFNvdXJjZUFjdGlvbiB7XHJcbiAgICAgICAgc3dpdGNoKHNlcmlhbGl6ZWRTb3VyY2VBY3Rpb25bXCJ0eXBlXCJdKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJMb2FkU291cmNlQWN0aW9uXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExvYWRTb3VyY2VBY3Rpb24oZW50aXR5KTtcclxuICAgICAgICAgICAgY2FzZSBcIlVwZGF0ZVNvdXJjZUFjdGlvblwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVcGRhdGVTb3VyY2VBY3Rpb24oZW50aXR5KTtcclxuICAgICAgICAgICAgY2FzZSBcIkRlbGV0ZVNvdXJjZUFjdGlvblwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEZWxldGVTb3VyY2VBY3Rpb24oZW50aXR5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgTnVsbFNvdXJjZUFjdGlvbihlbnRpdHkpO1xyXG4gICAgfSAgIFxyXG59IiwiaW1wb3J0IHsgRW50aXR5IH0gZnJvbSBcIi4vZW50aXR5XCI7XHJcbmltcG9ydCB7IFNvdXJjZSB9IGZyb20gXCIuL3NvdXJjZVwiO1xyXG5pbXBvcnQgeyBTb3VyY2VBY3Rpb24gfSBmcm9tIFwiLi9zb3VyY2VhY3Rpb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBVcGRhdGVTb3VyY2VBY3Rpb24gZXh0ZW5kcyBTb3VyY2VBY3Rpb24ge1xyXG4gICAgY29uc3RydWN0b3IoZW50aXR5OiBFbnRpdHkpIHtcclxuICAgICAgICBzdXBlcihcIlVwZGF0ZVNvdXJjZUFjdGlvblwiLCBlbnRpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzeW5jKHNvdXJjZTogU291cmNlKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3Qgc2VyaWFsaXplZEVudGl0eSA9IHRoaXMuZW50aXR5LnNlcmlhbGl6ZSgpO1xyXG5cclxuICAgICAgICB0aGlzLnZhbGlkYXRlVXBkYXRlKHNlcmlhbGl6ZWRFbnRpdHkpO1xyXG5cclxuICAgICAgICBjb25zdCBzZXJpYWxpemVkTG9hZGVkRW50aXR5ID0gc291cmNlLnVwZGF0ZShzZXJpYWxpemVkRW50aXR5KTtcclxuXHJcbiAgICAgICAgdGhpcy5lbnRpdHkuZGVzZXJpYWxpemUoc2VyaWFsaXplZExvYWRlZEVudGl0eSk7XHJcbiAgICB9XHJcbn0iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiaW1wb3J0IHsgQnJpZGdlIH0gZnJvbSBcIi4vYnJpZGdlXCI7XHJcbmltcG9ydCB7IERlbGV0ZVNvdXJjZUFjdGlvbiB9IGZyb20gXCIuL2RlbGV0ZXNvdXJjZWFjdGlvblwiO1xyXG5pbXBvcnQgeyBFbnRpdHkgfSBmcm9tIFwiLi9lbnRpdHlcIjtcclxuaW1wb3J0IHsgRW50aXR5RmFjdG9yeSB9IGZyb20gXCIuL2VudGl0eWZhY3RvcnlcIjtcclxuaW1wb3J0IHsgTG9hZFNvdXJjZUFjdGlvbiB9IGZyb20gXCIuL2xvYWRzb3VyY2VhY3Rpb25cIjtcclxuaW1wb3J0IHsgTnVsbFNvdXJjZSB9IGZyb20gXCIuL251bGxzb3VyY2VcIjtcclxuaW1wb3J0IHsgU291cmNlIH0gZnJvbSBcIi4vc291cmNlXCI7XHJcbmltcG9ydCB7IFNvdXJjZUFjdGlvbiB9IGZyb20gXCIuL3NvdXJjZWFjdGlvblwiO1xyXG5pbXBvcnQgeyBTb3VyY2VBY3Rpb25GYWN0b3J5IH0gZnJvbSBcIi4vc291cmNlYWN0aW9uZmFjdG9yeVwiO1xyXG5pbXBvcnQgeyBVcGRhdGVTb3VyY2VBY3Rpb24gfSBmcm9tIFwiLi91cGRhdGVzb3VyY2VhY3Rpb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBFbnRpdHlTdG9yZSB7XHJcbiAgICBwcml2YXRlIF9zb3VyY2VzOiBhbnkgPSB7fTtcclxuICAgIHByaXZhdGUgX2VudGl0aWVzOiBhbnkgPSB7fTtcclxuICAgIHByaXZhdGUgX2FjdGlvbnM6IGFueSA9IHt9O1xyXG5cclxuXHJcbiAgICBwdWJsaWMgZ2V0IGFjdGlvbnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFkZFNvdXJjZShlbnRpdHlOYW1lOiBhbnksIHNvdXJjZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5fc291cmNlc1tlbnRpdHlOYW1lXSA9IHNvdXJjZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcHVibGljIHJlZ2lzdGVyKGVudGl0eTogRW50aXR5LCBzb3VyY2U/OiBTb3VyY2UpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl9lbnRpdGllc1tlbnRpdHkua2V5XSA9IGVudGl0eTtcclxuXHJcbiAgICAgICAgaWYoIXNvdXJjZSkge1xyXG4gICAgICAgICAgICBsZXQgZW50aXR5U291cmNlID0gdGhpcy5fc291cmNlc1tlbnRpdHkubmFtZV07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZighZW50aXR5U291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICBlbnRpdHkuc291cmNlID0gbmV3IE51bGxTb3VyY2UoKTsgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBlbnRpdHkuc291cmNlID0gdGhpcy5fc291cmNlc1tlbnRpdHkubmFtZV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGVudGl0eS5zb3VyY2UgPSBzb3VyY2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzeW5jKCkge1xyXG4gICAgICAgIHdoaWxlIChPYmplY3Qua2V5cyh0aGlzLl9hY3Rpb25zKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHRoaXMuX2FjdGlvbnMpWzBdO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc291cmNlQWN0aW9uOiBTb3VyY2VBY3Rpb24gPSB0aGlzLl9hY3Rpb25zW2tleV07XHJcblxyXG4gICAgICAgICAgICAvL1RPRE86IGdlc3RpcmUgZW50aXTDoCBjb24gc291cmNlIGEgbnVsbCAobnVsbCBwYXR0ZXJuIT8pXHJcblxyXG4gICAgICAgICAgICAvKiRlbnRpdHlDbGFzcyA9IGdldF9jbGFzcygkc291cmNlQWN0aW9uLT5nZXRFbnRpdHkoKSk7XHJcblxyXG4gICAgICAgICAgICBpZihhcnJheV9rZXlfZXhpc3RzKCRlbnRpdHlDbGFzcywgJHRoaXMtPnNvdXJjZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAkc291cmNlQWN0aW9uLT5zeW5jKCR0aGlzLT5zb3VyY2VzW2dldF9jbGFzcygkc291cmNlQWN0aW9uLT5nZXRFbnRpdHkoKSldKTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIHNvdXJjZUFjdGlvbi5zeW5jKHNvdXJjZUFjdGlvbi5lbnRpdHkuc291cmNlKTtcclxuXHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hY3Rpb25zW2tleV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzeW5jVG8oYnJpZGdlOiBCcmlkZ2UpIHtcclxuICAgICAgICBjb25zdCBzZXJpYWxpemVkQWN0aW9uczogYW55ID0ge307XHJcblxyXG4gICAgICAgIGZvcihjb25zdCBrZXkgaW4gdGhpcy5fYWN0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCBhY3Rpb246IFNvdXJjZUFjdGlvbiA9IHRoaXMuX2FjdGlvbnNba2V5XTtcclxuICAgICAgICAgICAgLy8kZW50aXR5Q2xhc3MgPSBnZXRfY2xhc3MoJGFjdGlvbi0+Z2V0RW50aXR5KCkpO1xyXG5cclxuICAgICAgICAgICAgLy9pZihhcnJheV9rZXlfZXhpc3RzKCRlbnRpdHlDbGFzcywgJHRoaXMtPnNvdXJjZXMpKSB7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb24uc3luYyhhY3Rpb24uZW50aXR5LnNvdXJjZSk7XHJcbiAgICAgICAgICAgIC8vfVxyXG5cclxuICAgICAgICAgICAgc2VyaWFsaXplZEFjdGlvbnNba2V5XSA9IFNvdXJjZUFjdGlvbkZhY3Rvcnkuc2VyaWFsaXplKGFjdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBlbnRpdGllcyA9IGJyaWRnZS5zZW5kKHNlcmlhbGl6ZWRBY3Rpb25zKTtcclxuXHJcbiAgICAgICAgd2hpbGUgKE9iamVjdC5rZXlzKHRoaXMuX2FjdGlvbnMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3Qga2V5ID0gT2JqZWN0LmtleXModGhpcy5fYWN0aW9ucylbMF07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzb3VyY2VBY3Rpb246IFNvdXJjZUFjdGlvbiA9IHRoaXMuX2FjdGlvbnNba2V5XTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGVudGl0eUNsYXNzID0gc291cmNlQWN0aW9uLmVudGl0eS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgaWYoZW50aXRpZXNbZW50aXR5Q2xhc3NdKSB7XHJcbiAgICAgICAgICAgICAgICBzb3VyY2VBY3Rpb24uZW50aXR5LmRlc2VyaWFsaXplKGVudGl0aWVzW2VudGl0eUNsYXNzXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc291cmNlQWN0aW9uLnN5bmModGhpcy5fc291cmNlc1tlbnRpdHlDbGFzc10pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fYWN0aW9uc1trZXldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3luY0Zyb20oYnJpZGdlOiBCcmlkZ2UsIHJlY2VpdmVkQWN0aW9uczogYW55KSB7XHJcbiAgICAgICAgY29uc3QgZGVzZXJpYWxpemVkQWN0aW9uczogYW55ID0ge307XHJcbiAgICAgICAgY29uc3QgZW50aXRpZXM6IGFueSA9IHt9O1xyXG5cclxuICAgICAgICBmb3IoY29uc3Qga2V5IGluIHJlY2VpdmVkQWN0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCBhY3Rpb246IGFueSA9IHJlY2VpdmVkQWN0aW9uc1trZXldO1xyXG5cclxuICAgICAgICAgICAgaWYoIXRoaXMuX2VudGl0aWVzW2FjdGlvbltcImVudGl0eUtleVwiXV0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2VudGl0aWVzW2FjdGlvbltcImVudGl0eUtleVwiXV0gPSBFbnRpdHlGYWN0b3J5Lm5ld0VudGl0eSh0aGlzLCBhY3Rpb25bXCJlbnRpdHlcIl0sIHRoaXMuX2VudGl0aWVzW2FjdGlvbltcInJlZktleVwiXV0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLl9lbnRpdGllc1thY3Rpb25bXCJlbnRpdHlLZXlcIl1dO1xyXG5cclxuICAgICAgICAgICAgZW50aXR5LmRlc2VyaWFsaXplKGFjdGlvbltcImVudGl0eVwiXSk7XHJcblxyXG4gICAgICAgICAgICBkZXNlcmlhbGl6ZWRBY3Rpb25zW2tleV0gPSBTb3VyY2VBY3Rpb25GYWN0b3J5LmRlc2VyaWFsaXplKGFjdGlvbiwgZW50aXR5KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGVudGl0eUNsYXNzID0gZGVzZXJpYWxpemVkQWN0aW9uc1trZXldLmVudGl0eS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgaWYodGhpcy5fc291cmNlc1tlbnRpdHlDbGFzc10pIHtcclxuICAgICAgICAgICAgICAgIGRlc2VyaWFsaXplZEFjdGlvbnNba2V5XS5zeW5jKHRoaXMuX3NvdXJjZXNbZW50aXR5Q2xhc3NdKTtcclxuXHJcbiAgICAgICAgICAgICAgICBlbnRpdGllc1tlbnRpdHlDbGFzc10gPSBkZXNlcmlhbGl6ZWRBY3Rpb25zW2tleV0uZW50aXR5LnNlcmlhbGl6ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnN5bmMoKTtcclxuXHJcbiAgICAgICAgYnJpZGdlLnJlcGx5KGVudGl0aWVzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbG9hZChlbnRpdHk6IEVudGl0eSk6IHZvaWQge1xyXG4gICAgICAgIGlmKGVudGl0eS5pc1JlZmVyZW5jZWQgJiYgIWVudGl0eS5pc0l0ZW0gJiYgZW50aXR5LnJlZikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2FkKGVudGl0eS5yZWYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fYWN0aW9uc1tlbnRpdHkua2V5ICsgXCI6OmxvYWRcIl0gPSBuZXcgTG9hZFNvdXJjZUFjdGlvbihlbnRpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGRhdGUoZW50aXR5OiBFbnRpdHkpOiB2b2lkIHtcclxuICAgICAgICBpZihlbnRpdHkuaXNSZWZlcmVuY2VkICYmICFlbnRpdHkuaXNJdGVtICYmIGVudGl0eS5yZWYpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBkYXRlKGVudGl0eS5yZWYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fYWN0aW9uc1tlbnRpdHkua2V5ICsgXCI6OnVwZGF0ZVwiXSA9IG5ldyBVcGRhdGVTb3VyY2VBY3Rpb24oZW50aXR5KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGVsZXRlKGVudGl0eTogRW50aXR5KTogdm9pZCB7XHJcbiAgICAgICAgaWYoZW50aXR5LmlzUmVmZXJlbmNlZCAmJiAhZW50aXR5LmlzSXRlbSAmJiBlbnRpdHkucmVmKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRlbGV0ZShlbnRpdHkucmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2FjdGlvbnNbZW50aXR5LmtleSArIFwiOjpkZWxldGVcIl0gPSBuZXcgRGVsZXRlU291cmNlQWN0aW9uKGVudGl0eSk7XHJcbiAgICB9XHJcbn0iXSwibmFtZXMiOlsiRGVsZXRlU291cmNlQWN0aW9uIiwiU291cmNlQWN0aW9uIiwiY29uc3RydWN0b3IiLCJlbnRpdHkiLCJzdXBlciIsInN5bmMiLCJzb3VyY2UiLCJzZXJpYWxpemVkRW50aXR5IiwidGhpcyIsInNlcmlhbGl6ZSIsInZhbGlkYXRlRGVsZXRlIiwiZGVsZXRlIiwiZW50aXR5U3RvcmUiLCJuYW1lIiwicmVmIiwiaXRlbSIsIl9wcm9wZXJ0aWVzIiwiX2lzUmVmZXJlbmNlZCIsIl9zb3VyY2UiLCJOdWxsU291cmNlIiwiX2lzSXRlbSIsIl9pc0NvbGxlY3Rpb24iLCJfaXRlbSIsIl9lbnRpdHlTdG9yZSIsIl9uYW1lIiwiX2tleSIsInVuZGVmaW5lZCIsImtleSIsIl9yZWYiLCJyZWdpc3RlciIsImxvYWQiLCJ2YWx1ZSIsImdldCIsImluZGV4IiwicHJvcGVydGllcyIsImFkZCIsIkVudGl0eUZhY3RvcnkiLCJuZXdFbnRpdHkiLCJkZXNlcmlhbGl6ZSIsImNvbGxlY3Rpb25TaXplIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsInVwZGF0ZSIsInJlbW92ZSIsInRvUmVtb3ZlIiwiaSIsImVudGl0eVByb3BlcnR5IiwiRW50aXR5UHJvcGVydHkiLCJlbnRpdHlJdGVtIiwiaXNJdGVtIiwiRW50aXR5IiwiUHJveHkiLCJFbnRpdHlIYW5kbGVyIiwidGFyZ2V0IiwicHJvcGVydHkiLCJyZWNlaXZlciIsInNldCIsIm9iaiIsIl9pc0VudGl0eSIsIl92YWx1ZSIsIkxvYWRTb3VyY2VBY3Rpb24iLCJzZXJpYWxpemVkTG9hZGVkRW50aXR5IiwidmFsaWRhdGVMb2FkIiwiU291cmNlIiwiTnVsbFNvdXJjZUFjdGlvbiIsIkVycm9yIiwidHlwZSIsIl90eXBlIiwiX2VudGl0eSIsInZhbGlkYXRlVXBkYXRlIiwic291cmNlQWN0aW9uIiwic2VyaWFsaXplZFNvdXJjZUFjdGlvbiIsIlVwZGF0ZVNvdXJjZUFjdGlvbiIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiX3NvdXJjZXMiLCJfZW50aXRpZXMiLCJfYWN0aW9ucyIsImFkZFNvdXJjZSIsImVudGl0eU5hbWUiLCJlbnRpdHlTb3VyY2UiLCJzeW5jVG8iLCJicmlkZ2UiLCJzZXJpYWxpemVkQWN0aW9ucyIsImFjdGlvbiIsIlNvdXJjZUFjdGlvbkZhY3RvcnkiLCJlbnRpdGllcyIsInNlbmQiLCJlbnRpdHlDbGFzcyIsInN5bmNGcm9tIiwicmVjZWl2ZWRBY3Rpb25zIiwiZGVzZXJpYWxpemVkQWN0aW9ucyIsInJlcGx5IiwiaXNSZWZlcmVuY2VkIl0sInNvdXJjZVJvb3QiOiIifQ==