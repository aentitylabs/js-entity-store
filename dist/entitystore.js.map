{"version":3,"file":"entitystore.js","mappings":"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","sources":["webpack://jsentitystore/webpack/universalModuleDefinition","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\bridge.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\deletesourceaction.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\entity.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\entityfactory.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\entityhandler.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\entityproperty.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\entitystore.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\loadsourceaction.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\nullsource.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\nullsourceaction.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\source.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\sourceaction.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\sourceactionfactory.ts","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\updatesourceaction.ts","webpack://jsentitystore/webpack/bootstrap","webpack://jsentitystore/C:\\work\\aentity\\workspace\\js-entity-store\\src\\main.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"jsentitystore\"] = factory();\n\telse\n\t\troot[\"jsentitystore\"] = factory();\n})(this, function() {\nreturn ","export abstract class Bridge {\r\n    public abstract send(actions: any, onReply: any): any;\r\n    public abstract reply(entities: any): void;\r\n}","import { Entity } from \"./entity\";\r\nimport { EntityFactory } from \"./entityfactory\";\r\nimport { Source } from \"./source\";\r\nimport { SourceAction } from \"./sourceaction\";\r\n\r\nexport class DeleteSourceAction extends SourceAction {\r\n    constructor(entity: Entity) {\r\n        super(\"DeleteSourceAction\", entity);\r\n    }\r\n\r\n    public sync(source: Source): void {\r\n        const serializedEntity = this.entity.serialize();\r\n\r\n        const entityData = EntityFactory.buildEntityDataFromSchema(serializedEntity);\r\n\r\n        this.validateDelete(entityData);\r\n\r\n        source.delete(entityData);\r\n    }\r\n}","import { EntityFactory } from \"./entityfactory\";\r\nimport { EntityProperty } from \"./entityproperty\";\r\nimport { EntityStore } from \"./entitystore\";\r\nimport { NullSource } from \"./nullsource\";\r\nimport { Source } from \"./source\";\r\n\r\nexport class Entity {\r\n    private _entityStore: EntityStore;\r\n    protected _properties: any = {};\r\n    private _name: string;\r\n    private _key: string;\r\n    private _ref: Entity|undefined;\r\n    private _isReferenced: boolean = false;\r\n    private _source: Source = new NullSource();\r\n    private _isItem: boolean = false;\r\n    private _isCollection: boolean = false;\r\n    protected _item: any = {};\r\n    protected _itemPrototype: Entity|undefined;\r\n\r\n\r\n    public constructor(entityStore: EntityStore, name: string, ref?: Entity, item?: any)\r\n    {\r\n        this._entityStore = entityStore;\r\n\r\n        this._name = name;\r\n        this._key = name;\r\n        this._item = item;\r\n        this._isCollection = item ? true : false;\r\n\r\n        let source;\r\n\r\n        if(ref != null && ref != undefined) {\r\n            this._key = ref.getKey() + \"=>\" + this._key;\r\n            this._isReferenced = true;\r\n            source = ref._source;\r\n        }\r\n\r\n        this._ref = ref;\r\n\r\n        this._entityStore.register(this, source);\r\n\r\n        if(!ref) {\r\n            this._ref = this;\r\n            this._entityStore.load(this);\r\n        }\r\n\r\n        if(this._item) {\r\n            this._itemPrototype = EntityFactory.newEntity(this._entityStore, this._item, this);\r\n        }\r\n    }\r\n\r\n    public setKey(value: string) {\r\n        this._key = value;\r\n    }\r\n\r\n    public getKey(): string {\r\n        return this._key;\r\n    }\r\n\r\n    public setName(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    public getName(): string {\r\n        return this._name;\r\n    }\r\n\r\n    public getRef(): any {\r\n        return this._ref;\r\n    }\r\n\r\n    public getProperties(): any {\r\n        return this._properties;\r\n    }\r\n\r\n    public getSource() {\r\n        return this._source;\r\n    }\r\n\r\n    public getEntityStore() {\r\n        return this._entityStore;\r\n    }\r\n\r\n    public setSource(source: Source) {\r\n        this._source = source;\r\n    }\r\n\r\n    public isReferenced() {\r\n        return this._isReferenced;\r\n    }\r\n\r\n    public isCollection() {\r\n        return this._isCollection;\r\n    }\r\n\r\n    public setIsItem(value: boolean) {\r\n        this._isItem = value;\r\n    }\r\n\r\n    public isItem() {\r\n        return this._isItem;\r\n    }\r\n\r\n    public getItem() {\r\n        return this._item;\r\n    }\r\n\r\n    public getItemPrototype(): any {\r\n        return this._itemPrototype;\r\n    }\r\n\r\n    public delete() {\r\n        this._entityStore.delete(this);\r\n    }\r\n\r\n    public get(index: number) {\r\n        return this._properties[index].value;\r\n    }\r\n\r\n    public add(): Entity {\r\n        const entity = EntityFactory.newEntity(this._entityStore, this._item, this);\r\n\r\n        entity.deserialize(this.getItem());\r\n\r\n        const collectionSize = Object.keys(this.getProperties()).length;\r\n\r\n        this.getProperties()[collectionSize] = entity;\r\n\r\n        entity.setKey(entity.getKey() + \"[\" + (collectionSize) + \"]\");\r\n\r\n        entity.setIsItem(true);\r\n\r\n        this.getEntityStore().register(entity, this.getSource());\r\n\r\n        this.getEntityStore().update(entity);\r\n\r\n        this.getEntityStore().load(this);\r\n\r\n        return entity;\r\n    }\r\n\r\n    public remove(index: number) {\r\n        const toRemove = this.get(index);\r\n\r\n        this.getEntityStore().delete(toRemove);\r\n\r\n        this.getEntityStore().load(this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        const serializedEntity: any = {};\r\n\r\n        serializedEntity[\"entity\"] = this.getName();\r\n        serializedEntity[\"properties\"] = {};\r\n        serializedEntity[\"ref\"] = this.isReferenced();\r\n\r\n        for(var key in this.getProperties()) {\r\n            serializedEntity[\"properties\"][key] = this.getProperties()[key].serialize();\r\n        }\r\n\r\n        return serializedEntity;\r\n    }\r\n    \r\n    public deserialize(entity: any) {\r\n        this.setName(entity[\"entity\"]);\r\n\r\n        if(!entity[\"properties\"]) {\r\n            return;\r\n        }\r\n\r\n        let i = 0;\r\n\r\n        for(let key in entity[\"properties\"]) {\r\n            const entityProperty = new EntityProperty(this.getEntityStore(), this);\r\n\r\n            entityProperty.deserialize(entity[\"properties\"][key]);\r\n\r\n            this.getProperties()[key] = entityProperty;\r\n\r\n            if(this.isCollection()) {\r\n                const entityItem = entityProperty.value;\r\n\r\n                entityItem.setKey(entityItem.getKey() + \"[\" + i + \"]\");\r\n\r\n                entityItem.setIsItem(true);\r\n\r\n                this.getEntityStore().register(entityItem, this.getSource());\r\n            }\r\n\r\n            i++;\r\n        }\r\n    }\r\n}\r\n","import { Entity } from \"./entity\";\r\nimport { EntityHandler } from \"./entityhandler\";\r\nimport { EntityStore } from \"./entitystore\";\r\n\r\nexport class EntityFactory {\r\n    public static newEntity(entityStore: EntityStore, entity: any, ref?: Entity) {\r\n        let newEntity: Entity|null = null;\r\n        \r\n        if(entity[\"collectionItem\"]) {\r\n            newEntity = new Entity(entityStore, entity[\"entity\"], ref, entity[\"collectionItem\"]);\r\n        }\r\n        else {\r\n            newEntity = new Entity(entityStore, entity[\"entity\"], ref);\r\n        }\r\n\r\n        newEntity.deserialize(entity);\r\n\r\n        const entityProxy = new Proxy(newEntity, new EntityHandler())\r\n\r\n        return entityProxy;\r\n    }\r\n\r\n    public static buildEntitySchemaFromData(entity: Entity, entityData: any): any {\r\n        const serializedEntity: any = {};\r\n\r\n        serializedEntity[\"entity\"] = entity.getName();\r\n        serializedEntity[\"properties\"] = {};\r\n        serializedEntity[\"ref\"] = entity.isReferenced();\r\n\r\n        for(let key in entityData) {\r\n            if(entity.isCollection() === true) {\r\n                serializedEntity[\"collectionItem\"] = entity.getItem();\r\n\r\n                if(entity.getItemPrototype()) {\r\n                    serializedEntity[\"properties\"][key] = EntityFactory.buildEntitySchemaFromData(entity.getItemPrototype(), entityData[key]);\r\n                }\r\n            }\r\n            else if(entity.getProperties()[key].isEntity === true) {\r\n                serializedEntity[\"properties\"][key] = EntityFactory.buildEntitySchemaFromData(entity.getProperties()[key].value, entityData[key]);\r\n            }\r\n            else {\r\n                serializedEntity[\"properties\"][key] = {\r\n                    \"value\": entityData[key]\r\n                };\r\n            }\r\n        }\r\n\r\n        return serializedEntity;\r\n    }\r\n\r\n    public static buildEntityDataFromSchema(entitySchema: any): any {\r\n        const entityData: any = {};\r\n\r\n        for(let key in entitySchema.properties) {\r\n            if(entitySchema.properties[key][\"entity\"]) {\r\n                entityData[key] = EntityFactory.buildEntityDataFromSchema(entitySchema.properties[key]);\r\n            }\r\n            else {\r\n                entityData[key] = entitySchema.properties[key][\"value\"];\r\n            }\r\n        }\r\n\r\n        return entityData;\r\n    }\r\n}\r\n","export class EntityHandler {\r\n    get(target: any, property: any, receiver: any): any {\r\n        if(target.getProperties()[property]) {\r\n            return target.getProperties()[property].value;\r\n        }\r\n\r\n        return target[property];\r\n    }\r\n\r\n    set(obj: any, property: any, value: any): boolean {\r\n        if(obj.getProperties()[property]) {\r\n            obj.getProperties()[property].value = value;\r\n\r\n            obj.getEntityStore().update(obj);\r\n\r\n            return true;\r\n        }\r\n\r\n        obj[property] = value;\r\n\r\n        return true;\r\n    }\r\n}","import { Entity } from \"./entity\";\r\nimport { EntityFactory } from \"./entityfactory\";\r\nimport { EntityStore } from \"./entitystore\";\r\n\r\nexport class EntityProperty {\r\n    private _entityStore: EntityStore;\r\n    private _ref: Entity|undefined;\r\n    private _isEntity: boolean = false;\r\n    private _value: any;\r\n\r\n\r\n    public constructor(entityStore: EntityStore, ref?: Entity)\r\n    {\r\n        this._entityStore = entityStore;\r\n        this._ref = ref;\r\n    }\r\n\r\n    public get isEntity() {\r\n        return this._isEntity;\r\n    }\r\n\r\n    public get value() {\r\n        return this._value;\r\n    }\r\n\r\n    public set value(value) {\r\n        this._value = value;\r\n    }\r\n\r\n    public serialize(): any {\r\n        if(this._isEntity === true) {\r\n            return this._value.serialize();\r\n        }\r\n\r\n        return {\r\n            \"value\": this._value\r\n        };\r\n    }\r\n    \r\n    public deserialize(entityProperty: any) {\r\n        if(entityProperty[\"entity\"]) {\r\n            const ref: Entity|undefined = entityProperty[\"ref\"] === true ? this._ref : undefined;\r\n\r\n            this._value = EntityFactory.newEntity(this._entityStore, entityProperty, ref);\r\n            this._isEntity = true;\r\n\r\n            this._value.deserialize(entityProperty);\r\n\r\n            return;\r\n        }\r\n\r\n        this._value = entityProperty[\"value\"];\r\n    }\r\n}","import { Bridge } from \"./bridge\";\r\nimport { DeleteSourceAction } from \"./deletesourceaction\";\r\nimport { Entity } from \"./entity\";\r\nimport { EntityFactory } from \"./entityfactory\";\r\nimport { LoadSourceAction } from \"./loadsourceaction\";\r\nimport { NullSource } from \"./nullsource\";\r\nimport { Source } from \"./source\";\r\nimport { SourceAction } from \"./sourceaction\";\r\nimport { SourceActionFactory } from \"./sourceactionfactory\";\r\nimport { UpdateSourceAction } from \"./updatesourceaction\";\r\n\r\nexport class EntityStore {\r\n    private _sources: any = {};\r\n    private _entities: any = {};\r\n    private _actions: any = {};\r\n\r\n\r\n    public get actions() {\r\n        return this._actions;\r\n    }\r\n\r\n    public addSource(entityName: any, source: any) {\r\n        this._sources[entityName] = source;\r\n    }\r\n    \r\n    public register(entity: Entity, source?: Source): void {\r\n        this._entities[entity.getKey()] = entity;\r\n\r\n        if(!source) {\r\n            let entitySource = this._sources[entity.getName()];\r\n            \r\n            if(!entitySource) {\r\n                entity.setSource(new NullSource());\r\n            }\r\n            else {\r\n                entity.setSource(this._sources[entity.getName()]);\r\n            }\r\n        }\r\n        else {\r\n            entity.setSource(source);\r\n        }\r\n    }\r\n\r\n    public sync() {\r\n        while (Object.keys(this._actions).length > 0) {\r\n            const key = Object.keys(this._actions)[0];\r\n\r\n            const sourceAction: SourceAction = this._actions[key];\r\n\r\n            //TODO: gestire entità con source a null (null pattern!?)\r\n\r\n            /*$entityClass = get_class($sourceAction->getEntity());\r\n\r\n            if(array_key_exists($entityClass, $this->sources)) {\r\n                $sourceAction->sync($this->sources[get_class($sourceAction->getEntity())]);\r\n            }*/\r\n            sourceAction.sync(sourceAction.entity.getSource());\r\n\r\n            delete this._actions[key];\r\n        }\r\n    }\r\n\r\n    public syncTo(bridge: Bridge): Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            const serializedActions: any = {};\r\n\r\n            for(const key in this._actions) {\r\n                const action: SourceAction = this._actions[key];\r\n                //$entityClass = get_class($action->getEntity());\r\n    \r\n                //if(array_key_exists($entityClass, $this->sources)) {\r\n                    action.sync(action.entity.getSource());\r\n                //}\r\n    \r\n                serializedActions[key] = SourceActionFactory.serialize(action);\r\n            }\r\n    \r\n            bridge.send(serializedActions, (entities: any) => {\r\n                while (Object.keys(this._actions).length > 0) {\r\n                    const key = Object.keys(this._actions)[0];\r\n        \r\n                    const sourceAction: SourceAction = this._actions[key];\r\n        \r\n                    const entityClass = sourceAction.entity.getName();\r\n        \r\n                    if(entities[entityClass]) {\r\n                        sourceAction.entity.deserialize(entities[entityClass]);\r\n        \r\n                        if(this._sources[entityClass]) {\r\n                            sourceAction.sync(this._sources[entityClass]);\r\n                        }\r\n                    }\r\n        \r\n                    delete this._actions[key];\r\n                }\r\n\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    public syncFrom(bridge: Bridge, receivedActions: any, onSync: any) {\r\n        const deserializedActions: any = {};\r\n        const entities: any = {};\r\n\r\n        for(const key in receivedActions) {\r\n            const action: any = receivedActions[key];\r\n\r\n            if(!this._entities[action[\"entityKey\"]]) {\r\n                this._entities[action[\"entityKey\"]] = EntityFactory.newEntity(this, action[\"entity\"], this._entities[action[\"refKey\"]]);\r\n            }\r\n\r\n            const entity = this._entities[action[\"entityKey\"]];\r\n\r\n            entity.deserialize(action[\"entity\"]);\r\n\r\n            deserializedActions[key] = SourceActionFactory.deserialize(action, entity);\r\n\r\n            const entityClass = deserializedActions[key].entity.getName();\r\n\r\n            if(this._sources[entityClass]) {\r\n                deserializedActions[key].sync(this._sources[entityClass]);\r\n\r\n                entities[entityClass] = deserializedActions[key].entity;\r\n            }\r\n        }\r\n\r\n        onSync();\r\n\r\n        this.sync();\r\n\r\n        const serializedEntities: any = {};\r\n\r\n        for(const key in entities) {\r\n            serializedEntities[key] = entities[key].serialize();\r\n        }\r\n\r\n        bridge.reply(serializedEntities);\r\n    }\r\n\r\n    public load(entity: Entity): void {\r\n        if(entity.isReferenced() && !entity.isItem() && entity.getRef()) {\r\n            return this.load(entity.getRef());\r\n        }\r\n\r\n        this._actions[entity.getKey() + \"::load\"] = new LoadSourceAction(entity);\r\n    }\r\n\r\n    public update(entity: Entity): void {\r\n        if(entity.isReferenced() && !entity.isItem() && entity.getRef()) {\r\n            return this.update(entity.getRef());\r\n        }\r\n\r\n        this._actions[entity.getKey() + \"::update\"] = new UpdateSourceAction(entity);\r\n    }\r\n\r\n    public delete(entity: Entity): void {\r\n        if(entity.isReferenced() && !entity.isItem() && entity.getRef()) {\r\n            return this.delete(entity.getRef());\r\n        }\r\n\r\n        this._actions[entity.getKey() + \"::delete\"] = new DeleteSourceAction(entity);\r\n    }\r\n}","import { Entity } from \"./entity\";\r\nimport { EntityFactory } from \"./entityfactory\";\r\nimport { Source } from \"./source\";\r\nimport { SourceAction } from \"./sourceaction\";\r\n\r\nexport class LoadSourceAction extends SourceAction {\r\n    constructor(entity: Entity) {\r\n        super(\"LoadSourceAction\", entity);\r\n    }\r\n\r\n    public sync(source: Source): void {\r\n        const serializedEntity: any = this.entity.serialize();\r\n\r\n        const entityData = EntityFactory.buildEntityDataFromSchema(serializedEntity);\r\n            \r\n        const loadedEntity = source.load(entityData);\r\n\r\n        this.validateLoad(loadedEntity);\r\n\r\n        const entitySchema = EntityFactory.buildEntitySchemaFromData(this.entity, loadedEntity);\r\n\r\n        this.entity.deserialize(entitySchema);\r\n    }\r\n}","import { Source } from \"./source\";\r\n\r\nexport class NullSource extends Source {\r\n    public load(entity: any) {\r\n        return entity;\r\n    }\r\n    \r\n    public update(entity: any) {\r\n        return entity;\r\n    }\r\n\r\n    public delete(entity: any): void {\r\n        \r\n    }\r\n}\r\n","import { Entity } from \"./entity\";\r\nimport { Source } from \"./source\";\r\nimport { SourceAction } from \"./sourceaction\";\r\n\r\nexport class NullSourceAction extends SourceAction {\r\n    constructor(entity: Entity) {\r\n        super(\"NullSourceAction\", entity);\r\n    }\r\n\r\n    public sync(source: Source): void {\r\n        throw new Error(\"NullSourceAction: method not implemented.\");\r\n    }\r\n}","export abstract class Source {\r\n    public abstract load(entity: any): any;\r\n    public abstract update(entity: any): any;\r\n    public abstract delete(entity: any): void;\r\n}\r\n","import { Entity } from \"./entity\";\r\nimport { Source } from \"./source\";\r\n\r\nexport abstract class SourceAction {\r\n    private _type: string;\r\n    private _entity: Entity;\r\n\r\n\r\n    constructor(type: string, entity: Entity) {\r\n        this._type = type;\r\n        this._entity = entity;\r\n    }\r\n\r\n    public abstract sync(source: Source): void;\r\n\r\n    public get type() {\r\n        return this._type;\r\n    }\r\n\r\n    public get entity() {\r\n        return this._entity;\r\n    }\r\n\r\n    public set entity(value) {\r\n        this._entity = value;\r\n    }\r\n\r\n    protected validateLoad(serializedEntity: any) {\r\n        /*$validators = $this->entity->getEntityStore()->getLoadValidators();\r\n\r\n        $entityClass = $this->getEntity()->name;\r\n\r\n        if(array_key_exists($entityClass, $validators)) {\r\n            $updateValidator = $validators[$entityClass];\r\n\r\n            if(!$updateValidator->isValid($serializedEntity)) {\r\n                throw new EntityLoadValidationException($updateValidator->getPropertyErrors());\r\n            }\r\n        }*/\r\n    }\r\n\r\n    protected validateUpdate(serializedEntity: any) {\r\n        /*$validators = $this->entity->getEntityStore()->getUpdateValidators();\r\n\r\n        $entityClass = $this->getEntity()->name;\r\n\r\n        if(array_key_exists($entityClass, $validators)) {\r\n            $updateValidator = $validators[$entityClass];\r\n\r\n            if(!$updateValidator->isValid($serializedEntity)) {\r\n                throw new EntityUpdateValidationException($updateValidator->getPropertyErrors());\r\n            }\r\n        }*/\r\n    }\r\n\r\n    protected validateDelete(serializedEntity: any) {\r\n        /*$validators = $this->entity->getEntityStore()->getDeleteValidators();\r\n\r\n        $entityClass = $this->getEntity()->name;\r\n\r\n        if(array_key_exists($entityClass, $validators)) {\r\n            $updateValidator = $validators[$entityClass];\r\n\r\n            if(!$updateValidator->isValid($serializedEntity)) {\r\n                throw new EntityDeleteValidationException($updateValidator->getPropertyErrors());\r\n            }\r\n        }*/\r\n    }\r\n}","import { DeleteSourceAction } from \"./deletesourceaction\";\r\nimport { Entity } from \"./entity\";\r\nimport { LoadSourceAction } from \"./loadsourceaction\";\r\nimport { NullSourceAction } from \"./nullsourceaction\";\r\nimport { SourceAction } from \"./sourceaction\";\r\nimport { UpdateSourceAction } from \"./updatesourceaction\";\r\n\r\nexport class SourceActionFactory {\r\n    public static serialize(sourceAction: SourceAction): any {\r\n        const serializedSourceAction: any = {};\r\n\r\n        serializedSourceAction[\"type\"] = sourceAction.type;\r\n        serializedSourceAction[\"entityKey\"] = sourceAction.entity.getKey();\r\n        serializedSourceAction[\"entityType\"] = sourceAction.entity.getName();\r\n        serializedSourceAction[\"entity\"] = sourceAction.entity.serialize();\r\n        serializedSourceAction[\"refKey\"] = sourceAction.entity.getRef() ? sourceAction.entity.getRef().getKey() : undefined;\r\n\r\n        return serializedSourceAction;\r\n    }\r\n\r\n    public static deserialize(serializedSourceAction: any, entity: Entity): SourceAction {\r\n        switch(serializedSourceAction[\"type\"]) {\r\n            case \"LoadSourceAction\":\r\n                return new LoadSourceAction(entity);\r\n            case \"UpdateSourceAction\":\r\n                return new UpdateSourceAction(entity);\r\n            case \"DeleteSourceAction\":\r\n                return new DeleteSourceAction(entity);\r\n        }\r\n\r\n        return new NullSourceAction(entity);\r\n    }   \r\n}","import { Entity } from \"./entity\";\r\nimport { EntityFactory } from \"./entityfactory\";\r\nimport { Source } from \"./source\";\r\nimport { SourceAction } from \"./sourceaction\";\r\n\r\nexport class UpdateSourceAction extends SourceAction {\r\n    constructor(entity: Entity) {\r\n        super(\"UpdateSourceAction\", entity);\r\n    }\r\n\r\n    public sync(source: Source): void {\r\n        const serializedEntity = this.entity.serialize();\r\n\r\n        const entityData = EntityFactory.buildEntityDataFromSchema(serializedEntity);\r\n\r\n        this.validateUpdate(entityData);\r\n\r\n        const updatedEntity = source.update(entityData);\r\n\r\n        const entitySchema = EntityFactory.buildEntitySchemaFromData(this.entity, updatedEntity);\r\n\r\n        this.entity.deserialize(entitySchema);\r\n    }\r\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { EntityStore } from \"./entitystore\";\r\nimport { EntityFactory } from \"./entityfactory\";\r\nimport { Source } from \"./source\";\r\nimport { Bridge } from \"./bridge\";\r\n\r\nexport { EntityStore, EntityFactory, Source, Bridge }"],"names":["root","factory","exports","module","define","amd","this","DeleteSourceAction","SourceAction","constructor","entity","super","sync","source","serializedEntity","serialize","entityData","EntityFactory","buildEntityDataFromSchema","validateDelete","delete","entityStore","name","ref","item","_properties","_isReferenced","_source","NullSource","_isItem","_isCollection","_item","_entityStore","_name","_key","undefined","getKey","_ref","register","load","_itemPrototype","newEntity","setKey","value","setName","getName","getRef","getProperties","getSource","getEntityStore","setSource","isReferenced","isCollection","setIsItem","isItem","getItem","getItemPrototype","get","index","add","deserialize","collectionSize","Object","keys","length","update","remove","toRemove","key","i","entityProperty","EntityProperty","entityItem","Entity","Proxy","EntityHandler","buildEntitySchemaFromData","isEntity","entitySchema","properties","target","property","receiver","set","obj","_isEntity","_value","_sources","_entities","_actions","addSource","entityName","sourceAction","syncTo","bridge","Promise","resolve","reject","serializedActions","action","SourceActionFactory","send","entities","entityClass","syncFrom","receivedActions","onSync","deserializedActions","serializedEntities","reply","LoadSourceAction","UpdateSourceAction","loadedEntity","validateLoad","Source","NullSourceAction","Error","type","_type","_entity","validateUpdate","serializedSourceAction","updatedEntity","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","EntityStore","Bridge"],"sourceRoot":""}